<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Lock zoom to avoid accidental page zoom while resizing -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Ring Size Finder</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #f9f9f9;
      touch-action: manipulation;
      overscroll-behavior: none;
      text-align: center;
    }

    .step {
      max-width: 800px;
      margin: 2rem auto;
      background: #fff6f6;
      padding: 1.25rem;
      border: 1px solid #ddd;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.03);
    }

    .area {
      position: relative;
      width: min(92vw, 760px);
      height: min(60vh, 520px);
      min-height: 280px;
      margin: 1rem auto;
      background: #fff;
      border: 1px solid #ffb3b3;
      border-radius: 12px;
      overflow: hidden;
    }

    /* Calibration rectangle */
    #creditCard {
      width: 320px; /* start bigger so laptops can match easily */
      aspect-ratio: 85.6 / 53.98; /* exact ID-1 aspect ratio */
      background: #e6e6e6;
      border: 2px solid #111;
      border-radius: 12px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.06);
      pointer-events: none; /* we resize via controls/slider */
    }

    .controls { margin: .75rem 0 0; display: flex; align-items: center; justify-content: center; gap: .6rem; flex-wrap: wrap; }
    .btn {
      padding: .5rem 1rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ddd;
      background: #f3f3f3;
      cursor: pointer;
    }
    .btn:hover { background: #e9e9e9; }

    .slider {
      width: min(84vw, 560px);
      accent-color: #d33;
    }

    .hint { color: #777; font-size: .9rem; margin-top: .35rem; }

    /* Ring sizer */
    .sizer-area {
      position: relative;
      width: min(92vw, 520px);
      height: min(60vh, 480px);
      min-height: 320px;
      margin: 1rem auto;
      background: #fff;
      border: 1px solid #ffb3b3;
      border-radius: 12px;
    }

    #sizerCircle {
      width: 100px;
      height: 100px;
      border: 3px dotted #000;
      border-radius: 50%;
      background: rgba(211,211,211,0.5); /* light gray */
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      touch-action: none; /* allow pointer events with no browser gestures */
      cursor: grab;
      box-shadow: 0 0 6px rgba(0,0,0,0.15);
    }

    .diameter-line { margin-top: 10px; font-weight: 700; }
    .row { display: flex; justify-content: space-between; gap: 12px; align-items: center; margin-top: 10px; padding: 0 10px; font-weight: 700; }

    /* Make buttons/slider comfortable on mobile */
    @media (max-width: 480px) {
      .btn { padding: .55rem .9rem; }
    }
  </style>
</head>
<body>

  <!-- STEP 1: CALIBRATION -->
  <section class="step" id="step1">
    <h2>Step 1: Calibrate Your Screen</h2>
    <p>Resize the rectangle to match a real credit card (8.56 cm × 5.398 cm). Use the slider or ± for fine tuning.</p>

    <div class="area" id="cardArea">
      <div id="creditCard" aria-label="Credit card outline for calibration"></div>
    </div>

    <div class="controls">
      <button class="btn" id="cardSmaller">− 10 px</button>
      <input type="range" class="slider" id="cardSlider" min="120" max="1200" step="2" />
      <button class="btn" id="cardLarger">+ 10 px</button>
    </div>

    <div class="hint">
      Current width (pixels): <span id="cardWidthPxReadout">320</span> px
    </div>

    <div class="controls" style="margin-top: .9rem;">
      <button class="btn" id="skipBtn">Skip calibration</button>
      <button class="btn" id="nextBtn">Next</button>
    </div>
  </section>

  <!-- STEP 2: RING SIZER -->
  <section class="step" id="step2" style="display:none;">
    <h2>Step 2: Measure Your Ring Size</h2>
    <p>Place your ring on the screen and match the circle to the <strong>inner edge</strong>.</p>

    <div class="sizer-area">
      <div id="sizerCircle"></div>
    </div>

    <div class="controls">
      <button class="btn" id="circleSmaller">−</button>
      <button class="btn" id="circleLarger">+</button>
    </div>

    <div class="diameter-line" id="diameterOut">Diameter: — mm</div>

    <div class="row">
      <div id="usOut">US: —</div>
      <div id="ukOut">UK: —</div>
      <div id="euOut">EU: —</div>
    </div>
  </section>

  <script>
    /***********************
     * Calibration (pixel-based)
     ***********************/
    const DEFAULT_PX_PER_MM = 96 / 25.4; // ~3.78 px/mm fallback if skipped
    let pxPerMM = null;                  // computed after calibration

    const cardEl = document.getElementById('creditCard');
    const cardArea = document.getElementById('cardArea');
    const cardSlider = document.getElementById('cardSlider');
    const cardWidthPxReadout = document.getElementById('cardWidthPxReadout');

    // Initialize card width and slider based on container size
    function initCard() {
      const areaW = cardArea.clientWidth;
      // start around 60% of area width; clamp to slider bounds
      const startPx = Math.min(Math.max(Math.round(areaW * 0.6), parseInt(cardSlider.min)), parseInt(cardSlider.max));
      cardSlider.value = startPx;
      applyCardWidth(parseInt(cardSlider.value));
    }

    function applyCardWidth(px) {
      // Set width in pixels; height follows via aspect-ratio in CSS
      cardEl.style.width = px + 'px';
      // Update readout
      cardWidthPxReadout.textContent = px;
    }

    // Buttons & slider events
    document.getElementById('cardSmaller').addEventListener('click', () => {
      let v = parseInt(cardSlider.value) - 10;
      v = Math.max(v, parseInt(cardSlider.min));
      cardSlider.value = v;
      applyCardWidth(v);
    });

    document.getElementById('cardLarger').addEventListener('click', () => {
      let v = parseInt(cardSlider.value) + 10;
      v = Math.min(v, parseInt(cardSlider.max));
      cardSlider.value = v;
      applyCardWidth(v);
    });

    cardSlider.addEventListener('input', (e) => {
      applyCardWidth(parseInt(e.target.value));
    });

    // Next / Skip
    document.getElementById('nextBtn').addEventListener('click', () => {
      // compute px/mm based on rendered element width on the user's device
      const renderedPx = cardEl.getBoundingClientRect().width; // px on screen
      pxPerMM = renderedPx / 85.6; // 85.6 mm is the real card width
      localStorage.setItem('pxPerMM', String(pxPerMM));
      goStep(2);
    });

    document.getElementById('skipBtn').addEventListener('click', () => {
      pxPerMM = DEFAULT_PX_PER_MM;
      localStorage.setItem('pxPerMM', String(pxPerMM));
      goStep(2);
    });

    /***********************
     * Ring sizer
     ***********************/
    const sizerEl = document.getElementById('sizerCircle');
    const diameterOut = document.getElementById('diameterOut');
    const usOut = document.getElementById('usOut');
    const ukOut = document.getElementById('ukOut');
    const euOut = document.getElementById('euOut');

    let diameterPx = 120;
    let dragging = false;
    let startX = 0;

    const sizeChart = [
      { mm: 14.1, us: "3",   uk: "F",  eu: "44"   },
      { mm: 14.5, us: "3.5", uk: "G",  eu: "45.5" },
      { mm: 14.9, us: "4",   uk: "H",  eu: "46.5" },
      { mm: 15.3, us: "4.5", uk: "I",  eu: "48"   },
      { mm: 15.7, us: "5",   uk: "J",  eu: "49"   },
      { mm: 16.1, us: "5.5", uk: "K",  eu: "50.5" },
      { mm: 16.5, us: "6",   uk: "L",  eu: "51.5" },
      { mm: 16.9, us: "6.5", uk: "M",  eu: "53"   },
      { mm: 17.3, us: "7",   uk: "N",  eu: "54.5" },
      { mm: 17.7, us: "7.5", uk: "O",  eu: "56"   },
      { mm: 18.1, us: "8",   uk: "P",  eu: "57"   },
      { mm: 18.5, us: "8.5", uk: "Q",  eu: "58.5" },
      { mm: 18.9, us: "9",   uk: "R",  eu: "60"   },
      { mm: 19.4, us: "9.5", uk: "S",  eu: "61"   },
      { mm: 19.8, us: "10",  uk: "T",  eu: "62.5" },
      { mm: 20.2, us: "10.5",uk: "U",  eu: "63.5" },
      { mm: 20.6, us: "11",  uk: "V",  eu: "65"   },
      { mm: 21.0, us: "11.5",uk: "W",  eu: "66"   },
      { mm: 21.4, us: "12",  uk: "X",  eu: "67.5" },
      { mm: 21.8, us: "12.5",uk: "Y",  eu: "69"   },
      { mm: 22.2, us: "13",  uk: "Z",  eu: "70"   }
    ];

    function nearestSize(mm) {
      return sizeChart.reduce((prev, curr) =>
        Math.abs(curr.mm - mm) < Math.abs(prev.mm - mm) ? curr : prev
      );
    }

    function updateSizer() {
      // if user landed here and we have stored calibration, use it
      if (!pxPerMM) {
        const stored = parseFloat(localStorage.getItem('pxPerMM') || '0');
        pxPerMM = stored > 0 ? stored : DEFAULT_PX_PER_MM;
      }

      sizerEl.style.width  = diameterPx + 'px';
      sizerEl.style.height = diameterPx + 'px';

      const diameterMM = (diameterPx / pxPerMM).toFixed(1);
      const match = nearestSize(parseFloat(diameterMM));

      diameterOut.textContent = `Diameter: ${diameterMM} mm`;
      usOut.textContent = `US: ${match.us}`;
      ukOut.textContent = `UK: ${match.uk}`;
      euOut.textContent = `EU: ${match.eu}`;
    }

    // Drag to resize
    sizerEl.addEventListener('pointerdown', (e) => {
      dragging = true;
      startX = e.clientX;
      sizerEl.setPointerCapture(e.pointerId);
    });
    sizerEl.addEventListener('pointermove', (e) => {
      if (!dragging) return;
      const dx = e.clientX - startX;
      diameterPx = Math.max(30, Math.min(520, diameterPx + dx));
      startX = e.clientX;
      updateSizer();
    });
    sizerEl.addEventListener('pointerup', () => { dragging = false; });

    // Buttons for circle
    document.getElementById('circleSmaller').addEventListener('click', () => {
      diameterPx = Math.max(30, diameterPx - 1);
      updateSizer();
    });
    document.getElementById('circleLarger').addEventListener('click', () => {
      diameterPx = Math.min(520, diameterPx + 1);
      updateSizer();
    });

    function goStep(n) {
      document.getElementById('step1').style.display = (n === 1 ? 'block' : 'none');
      document.getElementById('step2').style.display = (n === 2 ? 'block' : 'none');
      if (n === 2) updateSizer();
    }

    // init
    window.addEventListener('load', () => {
      initCard();
      // Optional: auto-jump to step 2 if a previous calibration exists
      // const stored = parseFloat(localStorage.getItem('pxPerMM') || '0');
      // if (stored > 0) { pxPerMM = stored; goStep(2); } else { goStep(1); }
    });
  </script>
</body>
</html>
