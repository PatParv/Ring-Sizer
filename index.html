<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Ring Size Finder</title>
  <style>
    * { box-sizing: border-box; }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #2e555a;                 /* your teal page bg */
      touch-action: manipulation;
      overscroll-behavior: none;
    }

    /* Full-viewport frame removes extra gray and centers the card */
    .frame {
      min-height: 100vh;
      display: flex;
      align-items: center;                  /* vertical centering */
      justify-content: center;              /* horizontal centering */
      padding: 10px;                        /* tiny breathing room at edges */
    }

    /* Content card */
    .step {
      width: min(98vw, 1200px);
      background: #fff6f6;
      padding: 14px 16px 18px;              /* extra bottom so red border never clips */
      border: 1px solid #ddd;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .title { margin: 0 0 .5rem; text-align: center; }
    .subtitle { margin: .25rem 0 .6rem; text-align: center; }

    /* CALIBRATION AREA — bigger and guaranteed fully visible */
    .area {
      position: relative;
      width: 100%;                          /* use full card width */
      height: clamp(320px, 54vh, 520px);    /* taller, scales with screen */
      margin: 8px auto 10px;
      background: #fff;
      border: 1px solid #ffb3b3;            /* red outline you want to see fully */
      border-radius: 12px;
      overflow: hidden;                     /* no internal scrollbars */
    }

    .card-canvas {
      position: relative;
      width: 100%;
      height: 100%;
      display: grid;
      place-items: center;
      padding: 12px;
    }

    /* Calibration rectangle */
    #creditCard {
      width: 380px;                         /* good default; adjust with +/- */
      aspect-ratio: 85.6 / 53.98;
      background: #e6e6e6;
      border: 2px solid #111;
      border-radius: 16px;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.06);
      pointer-events: none;
    }

    .controls {
      margin: .5rem 0 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: .6rem;
      flex-wrap: wrap;
    }
    .btn {
      padding: .45rem .9rem;
      font-size: 1rem;
      border-radius: 10px;
      border: 1px solid #ddd;
      background: #f3f3f3;
      cursor: pointer;
    }
    .btn:hover { background: #e9e9e9; }
    .hint { color: #777; font-size: .9rem; margin-top: .3rem; }

    /* MEASUREMENT AREA — widened but shorter so everything fits */
    .sizer-area {
      position: relative;
      width: min(96vw, 760px);
      height: clamp(260px, 44vh, 380px);
      margin: 6px auto 8px;
      background: #fff;
      border: 1px solid #ffb3b3;
      border-radius: 12px;
    }

    #sizerCircle {
      width: 100px;
      height: 100px;
      border: 3px dotted #000;
      border-radius: 50%;
      background: rgba(211,211,211,0.5);
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      touch-action: none;
      cursor: grab;
      box-shadow: 0 0 6px rgba(0,0,0,0.15);
    }

    .diameter-line { margin-top: 4px; font-weight: 700; text-align: center; }

    /* Size cards */
    .sizes-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 8px;
    }
    .size-card {
      background: #ffffff;
      border: 1px solid #e6e6e6;
      border-radius: 12px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.05);
      padding: 8px 6px;
    }
    .size-card .label {
      font-size: .72rem;
      letter-spacing: .04em;
      text-transform: uppercase;
      color: #777;
      margin-bottom: 4px;
    }
    .size-card .value {
      font-size: 1.25rem;
      font-weight: 800;
      color: #111;
      line-height: 1.05;
    }

    @media (max-width: 520px) {
      .size-card .value { font-size: 1.12rem; }
      .btn { padding: .45rem .8rem; }
    }
  </style>
</head>
<body>
  <main class="frame">
    <section class="step" id="step1">
      <h2 class="title">Step 1: Calibrate Your Screen</h2>
      <p class="subtitle">Resize the rectangle to match a real credit card (8.56 cm × 5.398 cm).</p>

      <div class="area" id="cardArea">
        <div class="card-canvas">
          <div id="creditCard"></div>
        </div>
      </div>

      <div class="controls">
        <button class="btn" id="cardSmaller">−</button>
        <button class="btn" id="cardLarger">+</button>
      </div>

      <div class="hint">Current width: <span id="cardWidthPxReadout">380</span> px</div>

      <div class="controls" style="margin-top:.6rem;">
        <button class="btn" id="skipBtn">Skip calibration</button>
        <button class="btn" id="nextBtn">Next</button>
      </div>
    </section>

    <section class="step" id="step2" style="display:none;">
      <h2 class="title">Step 2: Measure Your Ring Size</h2>
      <p class="subtitle">Place your ring on the screen and match the circle to the <strong>inner edge</strong>.</p>

      <div class="sizer-area">
        <div id="sizerCircle"></div>
      </div>

      <div class="controls" style="margin-top:.25rem">
        <button class="btn" id="circleSmaller">−</button>
        <button class="btn" id="circleLarger">+</button>
        <button class="btn" id="reset18">Reset to 18 mm</button>
      </div>

      <div class="diameter-line" id="diameterOut" aria-live="polite">Diameter: — mm</div>

      <div class="sizes-grid" aria-live="polite">
        <div class="size-card"><div class="label">US</div><div class="value" id="usValue">—</div></div>
        <div class="size-card"><div class="label">UK</div><div class="value" id="ukValue">—</div></div>
        <div class="size-card"><div class="label">EU</div><div class="value" id="euValue">—</div></div>
      </div>
    </section>
  </main>

  <script>
    const DEFAULT_PX_PER_MM = 96 / 25.4;
    let pxPerMM = null;

    const cardEl = document.getElementById('creditCard');
    const cardWidthPxReadout = document.getElementById('cardWidthPxReadout');

    function applyCardWidth(px) {
      cardEl.style.width = px + 'px';
      cardWidthPxReadout.textContent = px;
    }

    let cardWidthPx = 380;
    applyCardWidth(cardWidthPx);

    document.getElementById('cardSmaller').addEventListener('click', () => {
      cardWidthPx = Math.max(120, cardWidthPx - 10);
      applyCardWidth(cardWidthPx);
    });
    document.getElementById('cardLarger').addEventListener('click', () => {
      cardWidthPx = Math.min(2400, cardWidthPx + 10);
      applyCardWidth(cardWidthPx);
    });

    function goStep(n) {
      document.getElementById('step1').style.display = (n === 1 ? 'block' : 'none');
      document.getElementById('step2').style.display = (n === 2 ? 'block' : 'none');
      if (n === 2) {
        setDefaultDiameter(18);
        updateSizer();
      }
    }

    document.getElementById('nextBtn').addEventListener('click', () => {
      const renderedPx = cardEl.getBoundingClientRect().width;
      pxPerMM = renderedPx / 85.6;
      localStorage.setItem('pxPerMM', String(pxPerMM));
      goStep(2);
    });

    document.getElementById('skipBtn').addEventListener('click', () => {
      pxPerMM = DEFAULT_PX_PER_MM;
      localStorage.setItem('pxPerMM', String(pxPerMM));
      goStep(2);
    });

    /* Ring sizer */
    const sizerEl = document.getElementById('sizerCircle');
    const diameterOut = document.getElementById('diameterOut');
    const usValue = document.getElementById('usValue');
    const ukValue = document.getElementById('ukValue');
    const euValue = document.getElementById('euValue');

    let diameterPx = 0;
    let dragging = false;
    let startX = 0;

    const sizeChart = [
      { mm: 14.1, us: "3",   uk: "F",  eu: "44"   },
      { mm: 14.5, us: "3.5", uk: "G",  eu: "45.5" },
      { mm: 14.9, us: "4",   uk: "H",  eu: "46.5" },
      { mm: 15.3, us: "4.5", uk: "I",  eu: "48"   },
      { mm: 15.7, us: "5",   uk: "J",  eu: "49"   },
      { mm: 16.1, us: "5.5", uk: "K",  eu: "50.5" },
      { mm: 16.5, us: "6",   uk: "L",  eu: "51.5" },
      { mm: 16.9, us: "6.5", uk: "M",  eu: "53"   },
      { mm: 17.3, us: "7",   uk: "N",  eu: "54.5" },
      { mm: 17.7, us: "7.5", uk: "O",  eu: "56"   },
      { mm: 18.1, us: "8",   uk: "P",  eu: "57"   },
      { mm: 18.5, us: "8.5", uk: "Q",  eu: "58.5" },
      { mm: 18.9, us: "9",   uk: "R",  eu: "60"   },
      { mm: 19.4, us: "9.5", uk: "S",  eu: "61"   },
      { mm: 19.8, us: "10",  uk: "T",  eu: "62.5" },
      { mm: 20.2, us: "10.5",uk: "U",  eu: "63.5" },
      { mm: 20.6, us: "11",  uk: "V",  eu: "65"   },
      { mm: 21.0, us: "11.5",uk: "W",  eu: "66"   },
      { mm: 21.4, us: "12",  uk: "X",  eu: "67.5" },
      { mm: 21.8, us: "12.5",uk: "Y",  eu: "69"   },
      { mm: 22.2, us: "13",  uk: "Z",  eu: "70"   }
    ];

    function nearestSize(mm) {
      return sizeChart.reduce((prev, curr) =>
        Math.abs(curr.mm - mm) < Math.abs(prev.mm - mm) ? curr : prev
      );
    }

    function setDefaultDiameter(targetMM) {
      if (!pxPerMM) {
        const stored = parseFloat(localStorage.getItem('pxPerMM') || '0');
        pxPerMM = stored > 0 ? stored : DEFAULT_PX_PER_MM;
      }
      diameterPx = Math.round(pxPerMM * targetMM);
      diameterPx = Math.max(30, Math.min(760, diameterPx));
    }

    function updateSizer() {
      if (!pxPerMM) {
        const stored = parseFloat(localStorage.getItem('pxPerMM') || '0');
        pxPerMM = stored > 0 ? stored : DEFAULT_PX_PER_MM;
      }
      sizerEl.style.width  = diameterPx + 'px';
      sizerEl.style.height = diameterPx + 'px';

      const diameterMM = (diameterPx / pxPerMM).toFixed(1);
      const match = nearestSize(parseFloat(diameterMM));

      diameterOut.textContent = `Diameter: ${diameterMM} mm`;
      usValue.textContent = match.us;
      ukValue.textContent = match.uk;
      euValue.textContent = match.eu;
    }

    sizerEl.addEventListener('pointerdown', (e) => {
      dragging = true;
      startX = e.clientX;
      sizerEl.setPointerCapture(e.pointerId);
    });
    sizerEl.addEventListener('pointermove', (e) => {
      if (!dragging) return;
      const dx = e.clientX - startX;
      diameterPx = Math.max(30, Math.min(760, diameterPx + dx));
      startX = e.clientX;
      updateSizer();
    });
    sizerEl.addEventListener('pointerup', () => { dragging = false; });

    document.getElementById('circleSmaller').addEventListener('click', () => {
      diameterPx = Math.max(30, diameterPx - 1);
      updateSizer();
    });
    document.getElementById('circleLarger').addEventListener('click', () => {
      diameterPx = Math.min(760, diameterPx + 1);
      updateSizer();
    });
    document.getElementById('reset18').addEventListener('click', () => {
      setDefaultDiameter(18);
      updateSizer();
    });
  </script>
</body>
</html>
