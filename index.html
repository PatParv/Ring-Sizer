<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Lock zoom on the whole page -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Ring Size Finder</title>
  <style>
    * { box-sizing: border-box; }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;                 /* no page scroll */
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #2e555a;
      color: #111;
      touch-action: manipulation;
      overscroll-behavior: none;
    }

    .frame {
      min-height: 100dvh;               /* fill viewport, avoid mobile bounce */
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px;                     /* tiny edge padding to prevent clipping */
    }

    .step {
      width: min(98vw, 1200px);
      background: #fff6f6;
      padding: 12px 14px 14px;
      border: 1px solid #ddd;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .title { margin: 0 0 .4rem; text-align: center; }
    .subtitle { margin: .2rem 0 .6rem; text-align: center; }

    /* Shared stage (white box) */
    .stage {
      position: relative;
      width: 100%;
      max-width: 1200px;
      height: clamp(300px, 50vh, 500px);  /* card calibration height */
      margin: 6px auto 8px;
      background: #fff;
      border: 1px solid #ffb3b3;
      border-radius: 12px;
      overflow: hidden;
      display: grid;
      place-items: center;
    }

    /* Ring sizer white box: intentionally shorter to remove extra top/bottom space */
    #sizerArea.stage {
      height: clamp(240px, 40vh, 360px);
    }

    .controls {
      margin: .45rem 0 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: .5rem;
      flex-wrap: wrap;
    }
    .btn {
      padding: .5rem 1rem;
      font-size: 1rem;
      border-radius: 10px;
      border: 1px solid #ddd;
      background: #f3f3f3;
      cursor: pointer;
    }
    .btn:hover { background: #e9e9e9; }

    .segmented {
      display: inline-flex;
      border: 1px solid #ddd;
      border-radius: 10px;
      overflow: hidden;
    }
    .segmented button {
      border: 0;
      background: #f3f3f3;
      padding: .5rem .9rem;
      cursor: pointer;
      font-size: .95rem;
    }
    .segmented button.active { background: #fff; font-weight: 700; }

    /* Calibration shapes */
    #creditCard {
      width: 380px;                      /* JS may override */
      aspect-ratio: 85.6 / 53.98;
      background: #e6e6e6;
      border: 2px solid #111;
      border-radius: 16px;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.06);
      pointer-events: none;
    }
    #coinCircle {
      width: 170px;                      /* visual start size; user adjusts */
      height: 170px;
      border-radius: 50%;
      background: #e6e6e6;
      border: 2px solid #111;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.06);
      pointer-events: none;
    }

    /* Ring sizer circle */
    #sizerCircle {
      width: 100px;
      height: 100px;
      border: 3px dotted #000;
      border-radius: 50%;
      background: rgba(211,211,211,0.5);
      position: relative;                /* centered by grid parent */
      touch-action: none;
      cursor: grab;
      box-shadow: 0 0 6px rgba(0,0,0,0.15);
    }

    .diameter-line { margin-top: 4px; font-weight: 700; text-align: center; }

    /* Size cards */
    .sizes-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 6px;
    }
    .size-card {
      background: #ffffff;
      border: 1px solid #e6e6e6;
      border-radius: 12px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.05);
      padding: 8px 6px;
      text-align: left;
    }
    .size-card .label {
      font-size: .72rem;
      letter-spacing: .04em;
      text-transform: uppercase;
      color: #777;
      margin-bottom: 4px;
    }
    .size-card .value {
      font-size: 1.25rem;
      font-weight: 800;
      color: #111;
      line-height: 1.05;
    }

    /* Mobile-only tweaks */
    @media (max-width: 520px) {
      .frame { padding: 0; }
      .step { width: 100vw; border-radius: 0; padding: 10px 10px 12px; }
      .stage { width: 100%; max-width: none; margin: 4px 0 6px; }
      /* keep heights modest to avoid page scroll on phones */
      .stage { height: clamp(280px, 48vh, 420px); }
      #sizerArea.stage { height: clamp(220px, 38vh, 340px); }
      .btn { min-width: 44px; padding: .55rem 1rem; font-size: 1.05rem; border-radius: 12px; }

      /* Hide the mode switch on mobile (coin-only UX) */
      .mode-switch { display: none; }
    }
  </style>
</head>
<body>
  <main class="frame">

    <!-- STEP 1: Calibration -->
    <section class="step" id="step1">
      <h2 class="title">Step 1: Calibrate Your Screen</h2>
      <p class="subtitle">Choose your method, then resize to match the real object.</p>

      <!-- Desktop mode switch (hidden on mobile) -->
      <div class="controls mode-switch" style="margin-bottom:.35rem">
        <div class="segmented" role="tablist" aria-label="Calibration method">
          <button id="modeCoinBtn" class="active" role="tab" aria-selected="true">Coin</button>
          <button id="modeCardBtn" role="tab" aria-selected="false">Credit card</button>
        </div>
      </div>

      <!-- COIN MODE (mobile default) -->
      <div id="coinMode">
        <div class="controls" style="margin-top:.15rem">
          <div class="segmented" aria-label="Coin type">
            <button id="coinEURBtn" class="active">€1</button>
            <button id="coinUSBtn">US quarter</button>
            <button id="coinUKBtn">UK £1</button>
            <button id="coinCADBtn">CAD quarter</button>
          </div>
        </div>

        <div class="stage" id="coinStage">
          <div id="coinCircle"></div>
        </div>

        <div class="controls">
          <button class="btn" id="coinSmaller">−</button>
          <button class="btn" id="coinLarger">+</button>
        </div>

        <div class="controls" style="margin-top:.45rem">
          <button class="btn" id="skipBtn1">Skip calibration</button>
          <button class="btn" id="nextBtn1">Next</button>
        </div>
      </div>

      <!-- CARD MODE (desktop default; unchanged) -->
      <div id="cardMode" style="display:none">
        <p class="subtitle" style="margin-top:.25rem">Match the long edge of a credit card.</p>
        <div class="stage" id="cardArea">
          <div id="creditCard"></div>
        </div>
        <div class="controls">
          <button class="btn" id="cardSmaller">−</button>
          <button class="btn" id="cardLarger">+</button>
        </div>
        <div class="controls" style="margin-top:.45rem">
          <button class="btn" id="skipBtn2">Skip calibration</button>
          <button class="btn" id="nextBtn2">Next</button>
        </div>
      </div>
    </section>

    <!-- STEP 2: Ring sizer -->
    <section class="step" id="step2" style="display:none;">
      <h2 class="title">Step 2: Measure Your Ring Size</h2>
      <p class="subtitle">Place your ring on the screen and match the circle to the <strong>inner edge</strong>.</p>

      <div class="stage" id="sizerArea">
        <div id="sizerCircle"></div>
      </div>

      <div class="controls" style="margin-top:.2rem">
        <button class="btn" id="circleSmaller">−</button>
        <button class="btn" id="circleLarger">+</button>
        <button class="btn" id="reset18">Reset to 18 mm</button>
      </div>

      <div class="diameter-line" id="diameterOut" aria-live="polite">Diameter: — mm</div>

      <div class="sizes-grid" aria-live="polite">
        <div class="size-card"><div class="label">US</div><div class="value" id="usValue">—</div></div>
        <div class="size-card"><div class="label">UK</div><div class="value" id="ukValue">—</div></div>
        <div class="size-card"><div class="label">EU</div><div class="value" id="euValue">—</div></div>
      </div>
    </section>

  </main>

  <script>
    // ===== Basics =====
    const DEFAULT_PX_PER_MM = 96 / 25.4; // fallback
    const IS_MOBILE = window.matchMedia('(max-width: 520px)').matches;

    // Coin diameters (mm)
    const COIN_EUR_1      = 23.25;
    const COIN_US_QUARTER = 24.26;
    const COIN_UK_1GBP    = 22.5;
    const COIN_CAD_QUART  = 23.88;

    let pxPerMM = null;

    // Mode switching (desktop can toggle; mobile defaults to coin)
    const modeCoinBtn = document.getElementById('modeCoinBtn');
    const modeCardBtn = document.getElementById('modeCardBtn');
    const coinMode = document.getElementById('coinMode');
    const cardMode = document.getElementById('cardMode');

    function setMode(mode) {
      const coinActive = (mode === 'coin');
      coinMode.style.display = coinActive ? 'block' : 'none';
      cardMode.style.display = coinActive ? 'none' : 'block';
      if (modeCoinBtn && modeCardBtn) {
        modeCoinBtn.classList.toggle('active', coinActive);
        modeCardBtn.classList.toggle('active', !coinActive);
        modeCoinBtn.setAttribute('aria-selected', coinActive ? 'true' : 'false');
        modeCardBtn.setAttribute('aria-selected', !coinActive ? 'true' : 'false');
      }
    }

    // Desktop default: card; Mobile default: coin
    setMode(IS_MOBILE ? 'coin' : 'card');

    if (modeCoinBtn && modeCardBtn) {
      modeCoinBtn.addEventListener('click', () => setMode('coin'));
      modeCardBtn.addEventListener('click', () => setMode('card'));
    }

    // ===== Coin calibration =====
    const coinEURBtn = document.getElementById('coinEURBtn');
    const coinUSBtn  = document.getElementById('coinUSBtn');
    const coinUKBtn  = document.getElementById('coinUKBtn');
    const coinCADBtn = document.getElementById('coinCADBtn');

    const coinCircle = document.getElementById('coinCircle');
    const coinSmaller = document.getElementById('coinSmaller');
    const coinLarger  = document.getElementById('coinLarger');

    let coinTargetMM = COIN_EUR_1;                // default to €1
    let coinPx = IS_MOBILE ? 150 : 170;           // start smaller on phones

    function updateCoinUI() {
      coinEURBtn.classList.toggle('active', coinTargetMM === COIN_EUR_1);
      coinUSBtn .classList.toggle('active', coinTargetMM === COIN_US_QUARTER);
      coinUKBtn .classList.toggle('active', coinTargetMM === COIN_UK_1GBP);
      coinCADBtn.classList.toggle('active', coinTargetMM === COIN_CAD_QUART);
      coinCircle.style.width = coinPx + 'px';
      coinCircle.style.height = coinPx + 'px';
    }

    coinEURBtn.addEventListener('click', () => { coinTargetMM = COIN_EUR_1;      updateCoinUI(); });
    coinUSBtn .addEventListener('click', () => { coinTargetMM = COIN_US_QUARTER; updateCoinUI(); });
    coinUKBtn .addEventListener('click', () => { coinTargetMM = COIN_UK_1GBP;    updateCoinUI(); });
    coinCADBtn.addEventListener('click', () => { coinTargetMM = COIN_CAD_QUART;  updateCoinUI(); });

    coinSmaller.addEventListener('click', () => {
      coinPx = Math.max(60, coinPx - 6);
      updateCoinUI();
    });
    coinLarger.addEventListener('click', () => {
      coinPx = Math.min(1000, coinPx + 6);
      updateCoinUI();
    });

    document.getElementById('nextBtn1').addEventListener('click', () => {
      const renderedPx = coinCircle.getBoundingClientRect().width;
      pxPerMM = renderedPx / coinTargetMM;
      localStorage.setItem('pxPerMM', String(pxPerMM));
      goStep(2);
    });
    document.getElementById('skipBtn1').addEventListener('click', () => {
      pxPerMM = DEFAULT_PX_PER_MM;
      localStorage.setItem('pxPerMM', String(pxPerMM));
      goStep(2);
    });

    // ===== Card calibration (desktop) =====
    const creditCard = document.getElementById('creditCard');
    let cardWidthPx = IS_MOBILE ? 320 : 380;

    function applyCardWidth(px) { creditCard.style.width = px + 'px'; }
    applyCardWidth(cardWidthPx);

    document.getElementById('cardSmaller').addEventListener('click', () => {
      cardWidthPx = Math.max(120, cardWidthPx - 10);
      applyCardWidth(cardWidthPx);
    });
    document.getElementById('cardLarger').addEventListener('click', () => {
      cardWidthPx = Math.min(2400, cardWidthPx + 10);
      applyCardWidth(cardWidthPx);
    });

    document.getElementById('nextBtn2').addEventListener('click', () => {
      const renderedPx = creditCard.getBoundingClientRect().width; // long edge
      pxPerMM = renderedPx / 85.6;
      localStorage.setItem('pxPerMM', String(pxPerMM));
      goStep(2);
    });
    document.getElementById('skipBtn2').addEventListener('click', () => {
      pxPerMM = DEFAULT_PX_PER_MM;
      localStorage.setItem('pxPerMM', String(pxPerMM));
      goStep(2);
    });

    // ===== Step switching =====
    function goStep(n) {
      document.getElementById('step1').style.display = (n === 1 ? 'block' : 'none');
      document.getElementById('step2').style.display = (n === 2 ? 'block' : 'none');
      if (n === 2) {
        setDefaultDiameter(18);
        updateSizer();
      }
    }

    // ===== Ring sizer =====
    const sizerEl = document.getElementById('sizerCircle');
    const diameterOut = document.getElementById('diameterOut');
    const usValue = document.getElementById('usValue');
    const ukValue = document.getElementById('ukValue');
    const euValue = document.getElementById('euValue');

    let diameterPx = 0;
    let dragging = false;
    let startX = 0;

    const sizeChart = [
      { mm: 14.1, us: "3",   uk: "F",  eu: "44"   },
      { mm: 14.5, us: "3.5", uk: "G",  eu: "45.5" },
      { mm: 14.9, us: "4",   uk: "H",  eu: "46.5" },
      { mm: 15.3, us: "4.5", uk: "I",  eu: "48"   },
      { mm: 15.7, us: "5",   uk: "J",  eu: "49"   },
      { mm: 16.1, us: "5.5", uk: "K",  eu: "50.5" },
      { mm: 16.5, us: "6",   uk: "L",  eu: "51.5" },
      { mm: 16.9, us: "6.5", uk: "M",  eu: "53"   },
      { mm: 17.3, us: "7",   uk: "N",  eu: "54.5" },
      { mm: 17.7, us: "7.5", uk: "O",  eu: "56"   },
      { mm: 18.1, us: "8",   uk: "P",  eu: "57"   },
      { mm: 18.5, us: "8.5", uk: "Q",  eu: "58.5" },
      { mm: 18.9, us: "9",   uk: "R",  eu: "60"   },
      { mm: 19.4, us: "9.5", uk: "S",  eu: "61"   },
      { mm: 19.8, us: "10",  uk: "T",  eu: "62.5" },
      { mm: 20.2, us: "10.5",uk: "U",  eu: "63.5" },
      { mm: 20.6, us: "11",  uk: "V",  eu: "65"   },
      { mm: 21.0, us: "11.5",uk: "W",  eu: "66"   },
      { mm: 21.4, us: "12",  uk: "X",  eu: "67.5" },
      { mm: 21.8, us: "12.5",uk: "Y",  eu: "69"   },
      { mm: 22.2, us: "13",  uk: "Z",  eu: "70"   }
    ];

    function nearestSize(mm) {
      return sizeChart.reduce((prev, curr) =>
        Math.abs(curr.mm - mm) < Math.abs(prev.mm - prev.mm) ? curr : prev
      );
    }

    function setDefaultDiameter(targetMM) {
      if (!pxPerMM) {
        const stored = parseFloat(localStorage.getItem('pxPerMM') || '0');
        pxPerMM = stored > 0 ? stored : DEFAULT_PX_PER_MM;
      }
      diameterPx = Math.round(pxPerMM * targetMM);
      diameterPx = Math.max(30, Math.min(760, diameterPx));
    }

    function updateSizer() {
      if (!pxPerMM) {
        const stored = parseFloat(localStorage.getItem('pxPerMM') || '0');
        pxPerMM = stored > 0 ? stored : DEFAULT_PX_PER_MM;
      }
      sizerEl.style.width  = diameterPx + 'px';
      sizerEl.style.height = diameterPx + 'px';

      const diameterMM = (diameterPx / pxPerMM).toFixed(1);
      const match = sizeChart.reduce((prev, curr) =>
        Math.abs(curr.mm - diameterMM) < Math.abs(prev.mm - diameterMM) ? curr : prev
      );

      diameterOut.textContent = `Diameter: ${diameterMM} mm`;
      usValue.textContent = match.us;
      ukValue.textContent = match.uk;
      euValue.textContent = match.eu;
    }

    // Drag to resize
    sizerEl.addEventListener('pointerdown', (e) => {
      dragging = true;
      startX = e.clientX;
      sizerEl.setPointerCapture(e.pointerId);
    });
    sizerEl.addEventListener('pointermove', (e) => {
      if (!dragging) return;
      const dx = e.clientX - startX;
      diameterPx = Math.max(30, Math.min(760, diameterPx + dx));
      startX = e.clientX;
      updateSizer();
    });
    sizerEl.addEventListener('pointerup', () => { dragging = false; });

    // Buttons for circle
    document.getElementById('circleSmaller').addEventListener('click', () => {
      diameterPx = Math.max(30, diameterPx - 1);
      updateSizer();
    });
    document.getElementById('circleLarger').addEventListener('click', () => {
      diameterPx = Math.min(760, diameterPx + 1);
      updateSizer();
    });
    document.getElementById('reset18').addEventListener('click', () => {
      setDefaultDiameter(18);
      updateSizer();
    });

    // Init coin UI + default mode
    updateCoinUI();

    function updateCoinUI() {
      document.getElementById('coinEURBtn').classList.toggle('active', true);
      document.getElementById('coinUSBtn').classList.toggle('active', false);
      document.getElementById('coinUKBtn').classList.toggle('active', false);
      document.getElementById('coinCADBtn').classList.toggle('active', false);
      // (sizes updated dynamically by coin selection handlers)
    }

    // Coin click handlers to manage 'active' state & target mm
    document.getElementById('coinEURBtn').addEventListener('click', () => {
      setCoinTarget(COIN_EUR_1, 'coinEURBtn');
    });
    document.getElementById('coinUSBtn').addEventListener('click', () => {
      setCoinTarget(COIN_US_QUARTER, 'coinUSBtn');
    });
    document.getElementById('coinUKBtn').addEventListener('click', () => {
      setCoinTarget(COIN_UK_1GBP, 'coinUKBtn');
    });
    document.getElementById('coinCADBtn').addEventListener('click', () => {
      setCoinTarget(COIN_CAD_QUART, 'coinCADBtn');
    });

    let coinTargetMM = COIN_EUR_1;
    let coinPx = IS_MOBILE ? 150 : 170;

    function setCoinTarget(mm, activeId) {
      coinTargetMM = mm;
      ['coinEURBtn','coinUSBtn','coinUKBtn','coinCADBtn'].forEach(id => {
        document.getElementById(id).classList.toggle('active', id === activeId);
      });
      coinCircle.style.width = coinPx + 'px';
      coinCircle.style.height = coinPx + 'px';
    }

    // +/- for coin
    document.getElementById('coinSmaller').addEventListener('click', () => {
      coinPx = Math.max(60, coinPx - 6);
      coinCircle.style.width = coinPx + 'px';
      coinCircle.style.height = coinPx + 'px';
    });
    document.getElementById('coinLarger').addEventListener('click', () => {
      coinPx = Math.min(1000, coinPx + 6);
      coinCircle.style.width = coinPx + 'px';
      coinCircle.style.height = coinPx + 'px';
    });

    document.getElementById('nextBtn1').addEventListener('click', () => {
      const renderedPx = coinCircle.getBoundingClientRect().width;
      pxPerMM = renderedPx / coinTargetMM;
      localStorage.setItem('pxPerMM', String(pxPerMM));
      goStep(2);
    });
    document.getElementById('skipBtn1').addEventListener('click', () => {
      pxPerMM = DEFAULT_PX_PER_MM;
      localStorage.setItem('pxPerMM', String(pxPerMM));
      goStep(2);
    });
  </script>
</body>
</html>
